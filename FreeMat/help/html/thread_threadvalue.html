<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<HTML>
<HEAD>
<TITLE>THREADVALUE Retrieve the return values from a thread
</TITLE>
</HEAD>
<BODY>
<H2>THREADVALUE Retrieve the return values from a thread
</H2>
<P>
Section: <A HREF=sec_thread.html> FreeMat Threads </A>
<H3>Usage</H3>
The <code>threadvalue</code> function retrieves the values returned
by the function specified in the <code>threadnew</code> call.  The
syntax for its use is
<PRE>
   [arg1,arg2,...,argN] = threadvalue(handle)
</PRE>
<P>
where <code>handle</code> is the value returned by a <code>threadnew</code> call.
Note that there are issues with <code>nargout</code>.  See the examples
section of <code>threadnew</code> for details on how to work around this
limitation.  Because the function you have spawned with <code>threadnew</code>
may still be executing, <code>threadvalue</code> must first <code>threadwait</code>
for the function to complete before retrieving the output values.
This wait may take an arbitrarily long time if the thread function
is caught in an infinite loop.  Hence, you can also specify
a timeout parameter to <code>threadvalue</code> as
<PRE>
   [arg1,arg2,...,argN] = threadvalue(handle,timeout)
</PRE>
<P>
where the <code>timeout</code> is specified in milliseconds.  If the
wait times out, an error is raised (that can be caught with a
<code>try</code> and <code>catch</code> block.  
<P>
In either case, if the thread function itself caused an error
and ceased execution abruptly, then calling <code>threadvalue</code> will
cause that function to raise an error, allowing you to retrieve
the error that was caused and correct it.  See the examples section
for more information.
<H3>Example</H3>
Here we do something very simple.  We want to obtain a listing of
all files on the system, but do not want the results to stop our
computation.  So we run the <code>system</code> call in a thread.
<PRE>
--&gt; a = threadnew;                         % Create the thread
--&gt; threadstart(a,'system',1,'ls -lrt /'); % Start the thread
--&gt; b = rand(100)\rand(100,1);             % Solve some equations simultaneously
--&gt; c = threadvalue(a);                    % Retrieve the file list
--&gt; size(c)                                % It is large!

ans = 
  1 24 

--&gt; threadfree(a);
</PRE>
In this example, we force the threaded function to cause an
exception (by calling the <code>error</code> function as the thread 
function).  When we call <code>threadvalue</code>, we get an error, instead
of the return value of the function
<PRE>
--&gt; a = threadnew

a = 
 3 

--&gt; threadstart(a,'error',0,'Hello world!'); % Will immediately stop due to error
--&gt; c = threadvalue(a)                     % The error comes to us
Error: Thread: Hello world!
--&gt; threadfree(a)
</PRE>
Note that the error has the text <code>Thread:</code> prepended to the message
to help you identify that this was an error in a different thread.
</BODY>
</HTML>
