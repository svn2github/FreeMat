<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with jLaTeX2HTML 2002 (1.62) JA patch-1.4
patched version by:  Kenshi Muto, Debian Project.
LaTeX2HTML 2002 (1.62),
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>IMPORT Foreign Function Import</TITLE>
<META NAME="description" CONTENT="IMPORT Foreign Function Import">
<META NAME="keywords" CONTENT="main">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="jLaTeX2HTML v2002 JA patch-1.4">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="main.css">

<LINK REL="next" HREF="node52.html">
<LINK REL="previous" HREF="node50.html">
<LINK REL="up" HREF="node47.html">
<LINK REL="next" HREF="node52.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html1697"
  HREF="node52.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html1693"
  HREF="node47.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html1687"
  HREF="node50.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html1695"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html1698"
  HREF="node52.html">LOADLIB Load Library Function</A>
<B> Up:</B> <A NAME="tex2html1694"
  HREF="node47.html">Special Functions</A>
<B> Previous:</B> <A NAME="tex2html1688"
  HREF="node50.html">HELP Help</A>
 &nbsp <B>  <A NAME="tex2html1696"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html1699"
  HREF="node51.html#SECTION00254100000000000000">Usage</A>
<LI><A NAME="tex2html1700"
  HREF="node51.html#SECTION00254200000000000000">Example</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A NAME="SECTION00254000000000000000">
IMPORT Foreign Function Import</A>
</H2>

<P>

<H3><A NAME="SECTION00254100000000000000">
Usage</A>
</H3>

<P>
The import function allows you to call functions that are compiled into
shared libraries, as if they were FreeMat functions. The usage is
<PRE>
  import(libraryname,symbol,function,return,arguments)
</PRE>
The argument <code>libraryname</code> is the name of the library (as a string)
to import the function from.  The second argument <code>symbol</code> (also
a string), is the name of the symbol to import from the library.  The
third argument <code>function</code> is the the name of the function after its
been imported into Freemat.  The fourth argument is a string that
specifies the return type of the function. It can take on one of the 
following types:

<UL>
<LI>'uint8' for an unsigned, 8-bit integer.
</LI>
<LI>'int8' for a signed, 8-bit integer.
</LI>
<LI>'uint16' an unsigned, 16-bit  integer.
</LI>
<LI>'int16' a signed, 16-bit integer.
</LI>
<LI>'uint32' for an unsigned, 32-bit integer.
</LI>
<LI>'int32' for a signed, 32-bit integer.
</LI>
<LI>'single' for a 32-bit floating point.
</LI>
<LI>'double' for a 64-bit floating point.
</LI>
<LI>'void' for no return type.
</LI>
</UL>
The fourth argument is more complicated.  It encodes the arguments of the
imported function using a special syntax.  In general, the argument list
is a string consisting of entries of the form:

<P>
<PRE>
  type[optional bounds check] {optional &amp;}name
</PRE>

<P>
Here is a list of various scenarios (expressed in 'C'), and the corresponding
entries, along with snippets of code.

<P>
<I>Scalar variable passed by value:</I>
Suppose a function is defined in the library as
<PRE>
  int fooFunction(float t),
</PRE>
i.e., it takes a scalar value (or a string) that is passed by value.  Then
the corresponding argument string would be
<PRE>
  'float t'
</PRE>
For a C-string, which corresponds to a function prototype of
<PRE>
  int fooFunction(const char *t),
</PRE>
the corresponding argument string would be
<PRE>
  'string t'
</PRE>
Other types are as listed above.  Note that FreeMat will automatically
promote the type of scalar variables to the type expected by the <code>C</code>
function.  For example, if we call a function expecting a <code>float</code>
with a <code>double</code> or <code>int16</code> argument, then FreeMat will automatically
apply type promotion rules prior to calling the function.

<P>
<I>Scalar variable passed by reference:</I>
Suppose a function is defined in the library as
<PRE>
  int fooFunction(float *t),
</PRE>
i.e., it takes a scalar value (or a string) that is passed as a pointer.  Then
the corresponding argument string would be
<PRE>
  'float &amp;t'
</PRE>
If the function <code>fooFunction</code> modifies <code>t</code>, then the argument
passed in FreeMat will also be modified.

<P>
<I>Array variable passed by value:</I>
In <code>C</code>, it is impossible to distinguish an array being passed from
a simple pointer being passed.  More often than not, another argument
indicates the length of the array.  FreeMat has the ability to perform
bounds-checking on array values.  For example, suppose we have a function
of the form
<PRE>
  int sum_onehundred_ints(int *t),
</PRE>
where <code>sum_onehundred_ints</code> assumes that <code>t</code> is a length <code>100</code> vector. 
Then the corresponding FreeMat argument is
<PRE>
  'float32[100] t'.
</PRE>
Note that because the argument is marked as not being passed by reference,
that if <code>sub_onehundred_ints</code> modifies the array <code>t</code>, this
will not affect the FreeMat argument.  Note that the bounds-check expression
can be any legal scalar expression that evaluates to an integer, and can be
a function of the arguments.  For example to pass a square <!-- MATH
 $N \times N$
 -->
<IMG
 WIDTH="71" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img39.png"
 ALT="$ N \times N$"> 
matrix to the following function:
<PRE>
  float determinantmatrix(int N, float *A),
</PRE>
we can use the following argument to <code>import</code>:
<PRE>
  'int32 N, float[N*N] t'.
</PRE>

<P>
<I>Array variable passed by reference:</I>
If the function in <code>C</code> modifies an array, and we wish this to be
reflected in the FreeMat side, we must pass that argument by reference.
Hence, consider the following hypothetical function that squares the
elements of an array (functionally equivalent to <IMG
 WIDTH="53" HEIGHT="29" ALIGN="BOTTOM" BORDER="0"
 SRC="img40.png"
 ALT="$ x.^2$">):
<PRE>
  void squarearray(int N, float *A)
</PRE>
we can use the following argument to <code>import</code>:
<PRE>
  'int32 N, float[N] &amp;A'.
</PRE>
Note that to avoid problems with memory allocation, external functions
are not allowed to return pointers.  As a result, as a general operating
mechanism, the FreeMat code must allocate the proper arrays, and then
pass them by reference to the external function.

<P>

<H3><A NAME="SECTION00254200000000000000">
Example</A>
</H3>

<P>
Here is a complete example.  We have a <code>C</code> function that adds
two float vectors of the same length, and stores the result in a third array 
that is modified by the function.  First, the <code>C</code> code:
<PRE> addArrays.c
void addArrays(int N, float *a, float *b, float *c) {
  int i;
 
  for (i=0;i&lt;N;i++)
   c[i] = a[i] + b[i];
}
</PRE>
We then compile this into a dynamic library, say, <code>add.so</code>.  The import 
command would then be:
<PRE>
  import('add.so','addArrays','addArrays','void', ...
         'int32 N, float[N] a, float[N] b, float[N] &amp;c');
</PRE>
We could then exercise the function exactly as if it had been written
in FreeMat.  The following only works on systems using the GNU
C Compiler:
<PRE>
--&gt; system('gcc -shared -fPIC -o add.so addArrays.c');
--&gt; import('add.so','addArrays','addArrays','void','int32 N, float[N] a, float[N] b, float[N] &amp;c');
Error: Unable to find file add.so on the current path!
--&gt; a = [3,2,3,1];
--&gt; b = [5,6,0,2]; 
--&gt; addArrays(length(a),a,b,c)
Error: Undefined function or variable addArrays
--&gt; c
Error: Undefined function or variable c
</PRE>

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html1697"
  HREF="node52.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html1693"
  HREF="node47.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html1687"
  HREF="node50.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html1695"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html1698"
  HREF="node52.html">LOADLIB Load Library Function</A>
<B> Up:</B> <A NAME="tex2html1694"
  HREF="node47.html">Special Functions</A>
<B> Previous:</B> <A NAME="tex2html1688"
  HREF="node50.html">HELP Help</A>
 &nbsp <B>  <A NAME="tex2html1696"
  HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
Samit Basu
2004-03-10
</ADDRESS>
</BODY>
</HTML>
